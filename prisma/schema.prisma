// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Borrow {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  toolName    String
  borrower    String
  borrowDate  DateTime
  returnDate  DateTime?
  status      String   @default("Open")
  location    String
  tools_keeper String
  createdAt   DateTime @default(now())
}

model stock_toolRoom {
  id          String        @id @default(auto()) @map("_id") @db.ObjectId
  toolId      String        @db.ObjectId
  toolName    String
  brand       String?
  PN          String?
  spec        String?
  quantity    Int
  createdAt   DateTime      @default(now())

  // Relasi ke ToolBroken
  brokenLogs  toolBroken[]

  // Relasi ke StockWarehouse (1-to-many)
  warehouseItems stock_warehouse? @relation(fields: [toolId], references: [id])
}

model toolBroken {
  id           String          @id @default(auto()) @map("_id") @db.ObjectId
  toolId       String          @db.ObjectId
  toolName     String
  quantity     Int
  brokenDate   DateTime        @default(now())
  reportedBy   String
  description  String?
  status       String          @default("Reported")
  createdAt    DateTime        @default(now())

  // Relasi ke Stock_ToolRoom
  tool         stock_toolRoom?  @relation(fields: [toolId], references: [id])
}

model stock_warehouse {
  id           String          @id @default(auto()) @map("_id") @db.ObjectId
  toolName     String
  brand        String?
  PN           String?
  spec         String?
  quantity     Int
  location     String
  createdAt    DateTime        @default(now())

  // Relasi ke Stock_ToolRoom
  toolRoom     stock_toolRoom[]
}


model request_tool {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  toolName    String
  quantity    Int
  requester   String
  brand       String?
  spec        String?
  PN          String?
  price       Int?
  reason      String
  location    String
  reference   String?
  note        String?
  status      String   @default("Open")
  createdAt   DateTime @default(now())
}

model StockHistory {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  toolName     String
  quantityChange     Int
  PN String
  brand String
  spec String
  action       String   // "WAREHOUSE_DECREASE", "TOOLROOM_INCREASE"
  source       String   // "warehouse", "toolroom"
  description  String?
  createdAt    DateTime @default(now())
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  userName  String   @unique  // 
  password  String
  createdAt DateTime @default(now())

  sessions Session[]

  @@map("users")
}
model Session {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionToken String   @unique
  userId       String   @db.ObjectId
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  identifier  String
  token       String   @unique
  expires     DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

